<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Cusco Store â€” Carrito</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body class="carrito-page">

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center gap-2" href="index.html">
        <img src="img/logo.jpg" alt="Logo de Cusco Store" class="brand-logo" width="32" height="32">
        <span>Cusco Store</span>
      </a>
      <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#nav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div id="nav" class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="index.html">Inicio</a></li>
          <li class="nav-item"><a class="nav-link" href="tienda.html">Tienda</a></li>
          <li class="nav-item">
            <a class="nav-link active" href="carrito.html">Carrito <span class="badge bg-info" id="badgeCarrito">0</span></a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container my-5">

    <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3 mb-3">
  <h1 class="h4 mb-0">Carrito</h1>

  <!-- BotÃ³n Ãºnico: Pedidos -->
  <div>
    <button class="btn btn-outline-secondary" id="btnVerPedidos">
      Lista de pedidos <span class="badge bg-secondary ms-1" id="badgePedidos">0</span>
    </button>
  </div>
</div>


    <!-- Aviso o promo opcional -->
    <div class="alert alert-secondary py-2 small mb-3">
      Â¡Ahora aceptamos pagos contra entrega! ðŸŽ‰
    </div>

    <!-- Caja principal -->
    <div class="card mb-3">
      <div class="card-body">

        <!-- Seleccionar todos -->
        <div class="d-flex align-items-center gap-2 mb-2">
          <input type="checkbox" id="selectAll" class="form-check-input">
          <label for="selectAll" class="form-check-label">Seleccionar todos</label>
          <span class="text-muted small ms-2" id="selCount">(0 seleccionados)</span>
        </div>

        <!-- Lista estilo Falabella -->
        <ul id="listaCarrito" class="list-group list-group-flush"></ul>
      </div>
    </div>

    <!-- Fallback total (por accesibilidad / impresiÃ³n) -->
    <div class="d-flex justify-content-between align-items-center d-lg-none mb-5">
      <strong>Total: <span id="total">S/ 0.00</span></strong>
      <a class="btn btn-outline-secondary btn-sm" href="tienda.html">Seguir comprando</a>
    </div>

    <!-- PASO 2: Datos de contacto y entrega (inicialmente oculto) -->
    <section id="checkoutDatos" class="card d-none mt-3" aria-hidden="true">
      <div class="card-body">
        <h2 class="h5 mb-3">Datos de contacto</h2>
        <form id="formDatos" novalidate>
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Nombre y Apellido *</label>
              <input type="text" class="form-control" id="nombre" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">Email *</label>
              <input type="email" class="form-control" id="email" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">TelÃ©fono</label>
              <input type="tel" class="form-control" id="telefono" inputmode="tel">
            </div>
          </div>

          <hr class="my-4">

          <h3 class="h6">Entrega</h3>
          <div class="d-flex flex-column gap-2 mb-3">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="entrega" id="entregaDelivery" value="delivery" checked>
              <label class="form-check-label" for="entregaDelivery">
                Delivery (costo estimado S/ <span id="envioLabel">10.00</span>)
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="entrega" id="entregaRecojo" value="recojo">
              <label class="form-check-label" for="entregaRecojo">
                Recojo en tienda (gratis)
              </label>
            </div>
          </div>

          <div id="direccionWrapper" class="row g-3 mb-1">
            <div class="col-12">
              <label class="form-label">DirecciÃ³n (solo delivery)</label>
              <input type="text" class="form-control" id="direccion" placeholder="Av. Siempre Viva 742">
            </div>
            <div class="col-md-6">
              <label class="form-label">Distrito</label>
              <input type="text" class="form-control" id="distrito">
            </div>
            <div class="col-md-6">
              <label class="form-label">Referencia</label>
              <input type="text" class="form-control" id="referencia" placeholder="Puerta negra, 3er piso">
            </div>
          </div>

          <div class="form-check mt-3">
            <input class="form-check-input" type="checkbox" id="terminos">
            <label class="form-check-label" for="terminos">
              Acepto los tÃ©rminos y condiciones
            </label>
          </div>
        </form>
      </div>
    </section>

    <!-- PASO 3: Pago (con mÃ©todos y resumen) -->
    <section id="checkoutPago" class="card d-none mt-3" aria-hidden="true">
      <div class="card-body">
        <h2 class="h5 mb-3">Pago</h2>

        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">MÃ©todo</label>
            <select id="pagoMetodo" class="form-select">
              <option value="visa" selected>Visa</option>
              <option value="mastercard">MasterCard</option>
              <option value="yape">Yape</option>
              <option value="plin">Plin</option>
              <option value="efectivo">Efectivo contra entrega</option>
            </select>
          </div>

          <div class="col-md-6 d-flex align-items-end">
            <div class="input-group">
              <input id="cuponInput" type="text" class="form-control" placeholder="CupÃ³n (ej: AHORRO10)">
              <button id="aplicarCupon" class="btn btn-outline-primary" type="button">Aplicar</button>
            </div>
          </div>
        </div>

        <!-- Datos de tarjeta (Visa/MasterCard) -->
        <div id="tarjetaWrapper" class="row g-3 mt-2">
          <div class="col-md-6">
            <label class="form-label">NÃºmero de tarjeta</label>
            <input type="text" class="form-control" id="cardNumber" placeholder="4111 1111 1111 1111" inputmode="numeric">
          </div>
          <div class="col-md-3">
            <label class="form-label">MM/AA</label>
            <input type="text" class="form-control" id="cardExp" placeholder="12/27">
          </div>
          <div class="col-md-3">
            <label class="form-label">CVV</label>
            <input type="text" class="form-control" id="cardCVV" placeholder="123" inputmode="numeric">
          </div>
        </div>

        <!-- Datos de Yape/Plin -->
        <div id="yapeWrapper" class="row g-3 mt-2 d-none">
          <div class="col-md-6">
            <label class="form-label">Celular vinculado</label>
            <input type="tel" class="form-control" id="yapePhone" placeholder="999 999 999" inputmode="tel">
          </div>
          <div class="col-md-6">
            <small class="text-muted d-block mt-2">
              Te pediremos confirmar el pago en tu app bancaria.
            </small>
          </div>
        </div>

        <!-- Resumen de costos -->
        <div class="mt-4">
          <h3 class="h6 mb-2">Resumen</h3>
          <div class="row small">
            <div class="col-6 text-muted">Subtotal</div>
            <div class="col-6 text-end"><span id="subtotal">S/ 0.00</span></div>

            <div class="col-6 text-muted">IGV (18%)</div>
            <div class="col-6 text-end"><span id="igv">S/ 0.00</span></div>

            <div class="col-6 text-muted">EnvÃ­o</div>
            <div class="col-6 text-end"><span id="envio">S/ 0.00</span></div>

            <div class="col-6 text-muted">Descuento</div>
            <div class="col-6 text-end"><span id="descuento">S/ 0.00</span></div>
          </div>

          <hr class="my-2">

          <div class="d-flex justify-content-between align-items-center">
            <div class="fw-bold">Total</div>
            <div class="fw-bold fs-5" id="totalResumen">S/ 0.00</div>
          </div>
        </div>
      </div>
    </section>

  </main>

  <!-- Barra fija inferior -->
  <div id="checkoutBar" class="checkout-bar">
    <div class="container d-flex flex-column flex-md-row align-items-center justify-content-between py-2">
      <div class="d-flex align-items-center gap-3">
        <div class="small text-muted">Total (seleccionados)</div>
        <div class="fs-5 fw-bold" id="totalResumen">S/ 0.00</div>
      </div>
      <div class="d-flex align-items-center gap-2 flex-wrap">
        <a class="btn btn-outline-secondary" href="tienda.html">Seguir comprando</a>
        <button id="btnContinuar" class="btn btn-primary">Continuar</button>
        <button id="comprar" class="btn btn-success d-none">Pagar ahora</button>
      </div>
    </div>
  </div>

  <!-- Modal compra (Factura/Boleta) -->
  <div class="modal fade" id="modalCompra" tabindex="-1" aria-labelledby="modalCompraLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content invoice">
        <div class="modal-header">
          <div class="d-flex align-items-center gap-3">
            <div class="invoice-logo rounded-circle d-flex align-items-center justify-content-center">
              <span class="fw-bold">MT</span>
            </div>
            <div>
              <h5 class="modal-title m-0" id="modalCompraLabel">Comprobante de compra</h5>
              <div class="text-muted small" id="orderId">â€”</div>
            </div>
          </div>
          <button class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>

        <div class="modal-body">
          <div class="row g-3 invoice-header">
            <div class="col-md-6">
              <div class="p-3 rounded border bg-white h-100">
                <div class="fw-bold mb-1">Mi Tienda Online</div>
                <div class="small text-muted">
                  RUC: 20XXXXXXXXX <br>
                  Av. Comercio 123, Lima <br>
                  soporte@mitienda.pe
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="p-3 rounded border bg-white h-100">
                <div class="fw-bold mb-1">Cliente</div>
                <div class="small">
                  <div id="billName">â€”</div>
                  <div id="billEmail" class="text-muted">â€”</div>
                  <div id="billEntrega" class="text-muted">â€”</div>
                </div>
              </div>
            </div>
          </div>

          <div class="table-responsive mt-3">
            <table class="table table-sm align-middle invoice-table">
              <thead>
                <tr>
                  <th>Producto</th>
                  <th class="text-center">Cant.</th>
                  <th class="text-end">P. Unit.</th>
                  <th class="text-end">Subtotal</th>
                </tr>
              </thead>
              <tbody id="invBody"><!-- filas dinÃ¡micas --></tbody>
            </table>
          </div>

          <div class="row mt-2">
            <div class="col-12 col-md-7"></div>
            <div class="col-12 col-md-5">
              <div class="invoice-totals p-3 rounded border bg-white">
                <div class="d-flex justify-content-between"><span class="text-muted">Subtotal</span><span id="invSub">S/ 0.00</span></div>
                <div class="d-flex justify-content-between"><span class="text-muted">IGV (18%)</span><span id="invIgv">S/ 0.00</span></div>
                <div class="d-flex justify-content-between"><span class="text-muted">EnvÃ­o</span><span id="invEnv">S/ 0.00</span></div>
                <div class="d-flex justify-content-between"><span class="text-muted">Descuento</span><span id="invDesc">- S/ 0.00</span></div>
                <hr class="my-2">
                <div class="d-flex justify-content-between fw-bold fs-5"><span>Total</span><span id="invTotal">S/ 0.00</span></div>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer d-flex justify-content-between">
          <div class="text-muted small">Gracias por su compra âœ¨</div>
          <div class="d-flex gap-2">
            <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Seguir comprando</button>
            <button class="btn btn-outline-primary" id="printInvoice">Imprimir</button>
            <button class="btn btn-primary" id="confirmarCompra">Confirmar</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/script.js"></script>

  <!-- ðŸ”¹ Script ligero para los botones y badges de listas -->
  <script>
  // Helpers mÃ­nimos
  const leer = (k, fb=[]) => { try { return JSON.parse(localStorage.getItem(k)) ?? fb; } catch { return fb; } };

  // RedirecciÃ³n Ãºnica
  document.getElementById('btnVerPedidos')?.addEventListener('click', () => {
    location.href = 'pedidos.html';
  });

  // Badge de pedidos
  (function actualizarBadgePedidos(){
    const pedidos  = leer('orders', []); // usamos 'orders' que ya guardas
    const b1 = document.getElementById('badgePedidos');
    if (b1) b1.textContent = pedidos.length;
  })();
</script>

</body>
</html>
